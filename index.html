<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
</head>
<body>
  <!-- âœ… ID OBRIGATORIO NA SCENE -->
  <a-scene id="arScene" embedded-ar 
           mindar-image viewer="ar" 
           image-target-src="tu-target.mind">

    <!-- âœ… ASSETS CORRECTOS -->
    <a-assets>
      <video id="mi-video" 
             src="mi-video.webm" 
             preload="auto" 
             crossorigin="anonymous" 
             playsinline 
             loop 
             muted 
             webkit-playsinline></video>
    </a-assets>

    <!-- âœ… CÃMARA -->
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <!-- âœ… TARGET 0 -->
    <a-entity mindar-image-target="targetIndex: 0">
      <!-- âœ… VIDEO CORRECTO -->
      <a-video id="videoAR" 
               src="#mi-video" 
               width="1.2" height="0.8" 
               position="0 0 0" 
               rotation="0 0 0"
               visible="false"></a-video>
      
      <!-- âœ… BOX DEBUG -->
      <a-box position="0 0.4 0" 
             color="#ff0000" 
             width="1.5" height="0.1" depth="1.5" 
             visible="false"></a-box>
    </a-entity>
  </a-scene>

  <!-- âœ… BOTÃ“N MEHORADO -->
  <button id="startBtn" style="
    position: fixed; z-index: 9999; bottom: 50px; left: 50%; 
    transform: translateX(-50%); padding: 20px 40px; 
    background: linear-gradient(45deg, #007bff, #0056b3); 
    color: white; border: none; border-radius: 50px; 
    font-size: 18px; font-weight: bold; box-shadow: 0 4px 15px rgba(0,123,255,0.4);
    cursor: pointer;">
    ğŸ¥ Escanear ImÃ¡n AR
  </button>

  <script>
    // âœ… VARIABLES GLOBAIS (CRÃTICO)
    let escena, video, videoAR, boxRojo, btn;

    // âœ… INICIALIZACIÃ“N
    document.addEventListener('DOMContentLoaded', () => {
      escena = document.querySelector('#arScene');
      video = document.getElementById('mi-video');
      videoAR = document.getElementById('videoAR');
      boxRojo = document.querySelector('a-box');
      btn = document.getElementById('startBtn');

      // âœ… PRECARREGA VIDEO
      video.load();
      video.muted = true;
      console.log('âœ… Video cargado:', video.src);
    });

    // âœ… EVENT HANDLER BOTÃ“N
    document.getElementById('startBtn').onclick = async () => {
      console.log('ğŸš€ Iniciando AR...');
      btn.style.display = 'none';

      // âœ… EVENTOS ANTES DE START
      escena.addEventListener('targetFound', (e) => {
        console.log('âœ… TARGET DETECTADO!', e.detail);
        videoAR.setAttribute('visible', true);
        boxRojo.setAttribute('visible', true);
        video.play().catch(err => console.error('Video error:', err));
        setTimeout(() => video.muted = false, 100);
      });

      escena.addEventListener('targetLost', () => {
        console.log('âŒ TARGET PERDIDO');
        videoAR.setAttribute('visible', false);
        boxRojo.setAttribute('visible', false);
        video.pause();
      });

      escena.addEventListener('arReady', () => {
        console.log('ğŸ‰ AR LISTO!');
      });

      // âœ… INICIO MINDAR
      try {
        await escena.components['mindar-image'].start();
        console.log('âœ… MindAR iniciado correctamente');
      } catch (error) {
        console.error('âŒ Error MindAR:', error);
      }
    };
  </script>
</body>
</html>
